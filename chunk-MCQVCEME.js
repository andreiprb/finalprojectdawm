import{c as ie,d as te,e as se,f as me}from"./chunk-JT4QCB65.js";import{$a as m,A as _,Ab as D,Be as ae,Ca as C,Ee as le,F as x,Ha as n,He as N,Ia as s,Ic as B,Ja as c,Jc as U,Je as pe,Ke as de,Le as ce,Na as E,Nb as V,Ob as u,Pb as A,Qa as h,Qb as R,R as F,S as y,Sa as v,Tb as k,Vb as G,Wb as O,Xb as q,Zb as j,bb as I,be as Z,ce as $,de as H,ee as W,fa as t,fe as J,j as b,ja as f,k as z,l as w,la as T,qe as K,ra as P,ta as o,te as Q,ue as X,v as L,ve as Y,we as ee,x as M,xe as re,ye as oe,ze as ne}from"./chunk-RZULHLTK.js";import"./chunk-X5YLR3NI.js";import{i as S}from"./chunk-ODN5LVDJ.js";var p=class{static strongPassword(){return i=>{let e=i.value;if(!e)return null;let r=/[A-Z]/.test(e),a=/[a-z]/.test(e),l=/[0-9]/.test(e),ge=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),fe=e.length>=N.PASSWORD_MIN_LENGTH,g={};return fe||(g.minLength=!0),r||(g.missingUpperCase=!0),a||(g.missingLowerCase=!0),l||(g.missingNumeric=!0),ge||(g.missingSpecialChar=!0),Object.keys(g).length?{strongPassword:g}:null}}static validEmail(){return i=>{let e=i.value;return e?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?null:{invalidEmail:!0}:null}}static goodEmail(i){return e=>{let r=e.value;return!r||!r.trim()?z(null):z(r).pipe(M(N.DEBOUNCE_TIME),_(),x(a=>b(i.getClient().rpc("check_email_exists",{email_input:a})).pipe(w(l=>l.data?{emailExists:!0}:null),L(()=>z(null)))))}}static passwordMatch(i){return e=>{let r=e.parent?.get(i),a=e.value;return!r||!a||r.value===a?null:{passwordMismatch:!0}}}static validName(){return i=>{let e=i.value;return e?/^[a-zA-ZÀ-ÿ\s]+$/.test(e)?null:{invalidName:!0}:null}}};function ve(d,i){if(d&1){let e=E();n(0,"form",6),h("ngSubmit",function(){F(e);let a=v();return y(a.onLogin())}),n(1,"nz-form-item")(2,"nz-form-label",7),m(3,"Email"),s(),n(4,"nz-form-control",8),c(5,"input",9),s()(),n(6,"nz-form-item")(7,"nz-form-label",7),m(8,"Password"),s(),n(9,"nz-form-control",8),c(10,"input",10),s()(),n(11,"nz-form-item")(12,"nz-form-control",11)(13,"label",12),m(14,"Remember me"),s()()(),n(15,"nz-form-item")(16,"nz-form-control",11)(17,"button",13),m(18," Login "),s()()()()}if(d&2){let e=v();o("formGroup",e.loginForm),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.loginForm,"email")),t(),o("nzStatus",e.isFieldInvalid(e.loginForm,"email")?"error":""),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.loginForm,"password")),t(),o("nzStatus",e.isFieldInvalid(e.loginForm,"password")?"error":""),t(2),o("nzSpan",24),t(4),o("nzSpan",24),t(),o("nzLoading",e.isLoading)("disabled",e.loginForm.invalid)}}function ze(d,i){if(d&1){let e=E();n(0,"form",6),h("ngSubmit",function(){F(e);let a=v();return y(a.onRegister())}),n(1,"nz-form-item")(2,"nz-form-label",7),m(3,"First Name"),s(),n(4,"nz-form-control",8),c(5,"input",14),s()(),n(6,"nz-form-item")(7,"nz-form-label",7),m(8,"Last Name"),s(),n(9,"nz-form-control",8),c(10,"input",15),s()(),n(11,"nz-form-item")(12,"nz-form-label",7),m(13,"Email"),s(),n(14,"nz-form-control",8),c(15,"input",9),s()(),n(16,"nz-form-item")(17,"nz-form-label",7),m(18,"Password"),s(),n(19,"nz-form-control",8),c(20,"input",10),s()(),n(21,"nz-form-item")(22,"nz-form-label",7),m(23,"Confirm Password"),s(),n(24,"nz-form-control",8),c(25,"input",16),s()(),n(26,"nz-form-item")(27,"nz-form-control",11)(28,"button",13),m(29," Register "),s()()()()}if(d&2){let e=v();o("formGroup",e.registerForm),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"firstName")),t(),o("nzStatus",e.isFieldInvalid(e.registerForm,"firstName")?"error":""),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"lastName")),t(),o("nzStatus",e.isFieldInvalid(e.registerForm,"lastName")?"error":""),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"email")),t(),o("nzStatus",e.isFieldInvalid(e.registerForm,"email")?"error":""),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"password")),t(),o("nzStatus",e.isFieldInvalid(e.registerForm,"password")?"error":""),t(2),o("nzSpan",24),t(2),o("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"confirmPassword")),t(),o("nzStatus",e.isFieldInvalid(e.registerForm,"confirmPassword")?"error":""),t(2),o("nzSpan",24),t(),o("nzLoading",e.isLoading)("disabled",e.registerForm.invalid)}}var ue=class d{constructor(i,e,r,a,l){this.fb=i;this.authService=e;this.dbService=r;this.router=a;this.message=l}loginForm;registerForm;isLoginMode=!0;isLoading=!1;ngOnInit(){this.initializeForms()}initializeForms(){this.loginForm=this.fb.group({email:["",[u.required,p.validEmail()]],password:["",[u.required]],rememberMe:[!1]}),this.registerForm=this.fb.group({firstName:["",[u.required,p.validName()]],lastName:["",[u.required,p.validName()]],email:["",[u.required,p.validEmail()],[p.goodEmail(this.dbService)]],password:["",[u.required,p.strongPassword()]],confirmPassword:["",[u.required]]}),this.registerForm.get("confirmPassword")?.setValidators([u.required,p.passwordMatch("password")])}toggleMode(){this.isLoginMode=!this.isLoginMode,this.resetForms()}resetForms(){this.loginForm.reset(),this.registerForm.reset(),this.loginForm.get("rememberMe")?.setValue(!1)}onLogin(){return S(this,null,function*(){if(this.loginForm.valid){this.isLoading=!0;try{let{email:i,password:e,rememberMe:r}=this.loginForm.value;yield this.authService.signIn(i,e,r),this.message.success("Login successful!"),this.router.navigate([pe.DASHBOARD],{replaceUrl:!0})}catch(i){this.message.error(i.message||"Login failed")}finally{this.isLoading=!1}}else this.markFormGroupTouched(this.loginForm)})}onRegister(){return S(this,null,function*(){if(this.registerForm.valid){this.isLoading=!0;try{let{email:i,password:e,firstName:r,lastName:a}=this.registerForm.value;yield this.authService.signUp(i,e,r,a),this.message.success("Registration successful! Please check your email to verify your account."),this.isLoginMode=!0,this.resetForms()}catch(i){this.message.error(i.message||"Registration failed")}finally{this.isLoading=!1}}else this.markFormGroupTouched(this.registerForm)})}markFormGroupTouched(i){Object.keys(i.controls).forEach(e=>{i.get(e)?.markAsTouched()})}getErrorMessage(i,e){let r=i.get(e);if(r?.hasError("required"))return`${this.getFieldDisplayName(e)} is required`;if(r?.hasError("invalidEmail"))return"Please enter a valid email address";if(r?.hasError("emailExists"))return"This email address is already registered. Please use a different email or try logging in.";if(r?.hasError("invalidName"))return"Name can only contain letters and spaces";if(r?.hasError("passwordMismatch"))return"Passwords do not match";if(r?.hasError("strongPassword")){let a=r.errors.strongPassword,l=[];return a.minLength&&l.push("at least 6 characters"),a.missingUpperCase&&l.push("one uppercase letter"),a.missingLowerCase&&l.push("one lowercase letter"),a.missingNumeric&&l.push("one number"),a.missingSpecialChar&&l.push("one special character"),`Password must contain ${l.join(", ")}`}return""}getFieldDisplayName(i){return{firstName:"First name",lastName:"Last name",email:"Email",password:"Password",confirmPassword:"Confirm password"}[i]||i}isFieldInvalid(i,e){let r=i.get(e);return!!(r?.invalid&&(r?.dirty||r?.touched))}static \u0275fac=function(e){return new(e||d)(f(q),f(ce),f(de),f(le),f(ae))};static \u0275cmp=T({type:d,selectors:[["app-login"]],decls:8,vars:5,consts:[[1,"auth-container"],[1,"auth-card",3,"nzTitle"],["nz-form","",1,"auth-form",3,"formGroup"],[1,"toggle-section"],["nzText","or"],["nz-button","","nzType","link","nzBlock","",3,"click","disabled"],["nz-form","",1,"auth-form",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],[3,"nzSpan","nzErrorTip"],["nz-input","","formControlName","email","placeholder","Enter your email","type","email",3,"nzStatus"],["nz-input","","formControlName","password","placeholder","Enter your password","type","password",3,"nzStatus"],[3,"nzSpan"],["nz-checkbox","","formControlName","rememberMe"],["nz-button","","nzType","primary","nzBlock","",3,"nzLoading","disabled"],["nz-input","","formControlName","firstName","placeholder","Enter your first name","type","text",3,"nzStatus"],["nz-input","","formControlName","lastName","placeholder","Enter your last name","type","text",3,"nzStatus"],["nz-input","","formControlName","confirmPassword","placeholder","Confirm your password","type","password",3,"nzStatus"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"nz-card",1),P(2,ve,19,13,"form",2)(3,ze,30,24,"form",2),n(4,"div",3),c(5,"nz-divider",4),n(6,"button",5),h("click",function(){return r.toggleMode()}),m(7),s()()()()),e&2&&(t(),o("nzTitle",r.isLoginMode?"Login":"Register"),t(),C(r.isLoginMode?2:-1),t(),C(r.isLoginMode?-1:3),t(3),o("disabled",r.isLoading),t(),I(" ",r.isLoginMode?"Don't have an account? Register":"Already have an account? Login"," "))},dependencies:[D,j,k,V,A,R,G,O,te,ie,J,U,B,$,Z,W,H,Q,K,re,ee,X,Y,ne,oe,me,se],styles:[".auth-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;justify-content:center;align-items:center;padding:90px}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:400px}"]})};export{ue as LoginComponent};
