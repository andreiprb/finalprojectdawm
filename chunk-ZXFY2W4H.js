import{c as te,d as oe,e as me,f as le}from"./chunk-6WKAA3LA.js";import{$a as m,A as _,Ae as ae,Bb as D,Ce as se,F as x,Fe as de,Ha as a,Ia as s,Ie as N,Ja as c,Jc as B,Kc as Z,Ke as pe,Le as ce,Na as C,Ob as A,Pb as u,Qa as S,Qb as R,R as F,Rb as k,S as E,Sa as v,Ub as G,Wb as U,X as z,Xb as O,Yb as q,_b as j,bb as T,ce as $,de as H,ee as W,fa as o,fe as J,ge as K,j as b,ja as f,k as h,l as w,la as I,ra as P,re as Q,ta as i,ue as X,v as M,ve as Y,wb as V,we as ee,x as L,xe as re,ye as ie,ze as ne}from"./chunk-DHPFLWCX.js";import"./chunk-X5YLR3NI.js";import{i as y}from"./chunk-ODN5LVDJ.js";var d=class{static strongPassword(){return t=>{let e=t.value;if(!e)return null;let r=/[A-Z]/.test(e),n=/[a-z]/.test(e),l=/[0-9]/.test(e),ge=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),fe=e.length>=N.PASSWORD_MIN_LENGTH,g={};return fe||(g.minLength=!0),r||(g.missingUpperCase=!0),n||(g.missingLowerCase=!0),l||(g.missingNumeric=!0),ge||(g.missingSpecialChar=!0),Object.keys(g).length?{strongPassword:g}:null}}static validEmail(){return t=>{let e=t.value;return e?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?null:{invalidEmail:!0}:null}}static goodEmail(t){return e=>{let r=e.value;return!r||!r.trim()?h(null):h(r).pipe(L(N.DEBOUNCE_TIME),_(),x(n=>b(t.getClient().rpc("check_email_exists",{email_input:n})).pipe(w(l=>l.data?{emailExists:!0}:null),M(()=>h(null)))))}}static passwordMatch(t){return e=>{let r=e.parent?.get(t),n=e.value;return!r||!n||r.value===n?null:{passwordMismatch:!0}}}static validName(){return t=>{let e=t.value;return e?/^[a-zA-ZÀ-ÿ\s]+$/.test(e)?null:{invalidName:!0}:null}}};function ve(p,t){if(p&1){let e=C();a(0,"form",6),S("ngSubmit",function(){F(e);let n=v();return E(n.onLogin())}),a(1,"nz-form-item")(2,"nz-form-label",7),m(3,"Email"),s(),a(4,"nz-form-control",8),c(5,"input",9),s()(),a(6,"nz-form-item")(7,"nz-form-label",7),m(8,"Password"),s(),a(9,"nz-form-control",8),c(10,"input",10),s()(),a(11,"nz-form-item")(12,"nz-form-control",11)(13,"label",12),m(14,"Remember me"),s()()(),a(15,"nz-form-item")(16,"nz-form-control",11)(17,"button",13),m(18," Login "),s()()()()}if(p&2){let e=v();i("formGroup",e.loginForm),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.loginForm,"email")),o(),i("nzStatus",e.isFieldInvalid(e.loginForm,"email")?"error":""),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.loginForm,"password")),o(),i("nzStatus",e.isFieldInvalid(e.loginForm,"password")?"error":""),o(2),i("nzSpan",24),o(4),i("nzSpan",24),o(),i("nzLoading",e.isLoading)("disabled",e.loginForm.invalid)}}function he(p,t){if(p&1){let e=C();a(0,"form",6),S("ngSubmit",function(){F(e);let n=v();return E(n.onRegister())}),a(1,"nz-form-item")(2,"nz-form-label",7),m(3,"First Name"),s(),a(4,"nz-form-control",8),c(5,"input",14),s()(),a(6,"nz-form-item")(7,"nz-form-label",7),m(8,"Last Name"),s(),a(9,"nz-form-control",8),c(10,"input",15),s()(),a(11,"nz-form-item")(12,"nz-form-label",7),m(13,"Email"),s(),a(14,"nz-form-control",8),c(15,"input",9),s()(),a(16,"nz-form-item")(17,"nz-form-label",7),m(18,"Password"),s(),a(19,"nz-form-control",8),c(20,"input",10),s()(),a(21,"nz-form-item")(22,"nz-form-label",7),m(23,"Confirm Password"),s(),a(24,"nz-form-control",8),c(25,"input",16),s()(),a(26,"nz-form-item")(27,"nz-form-control",11)(28,"button",13),m(29," Register "),s()()()()}if(p&2){let e=v();i("formGroup",e.registerForm),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"firstName")),o(),i("nzStatus",e.isFieldInvalid(e.registerForm,"firstName")?"error":""),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"lastName")),o(),i("nzStatus",e.isFieldInvalid(e.registerForm,"lastName")?"error":""),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"email")),o(),i("nzStatus",e.isFieldInvalid(e.registerForm,"email")?"error":""),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"password")),o(),i("nzStatus",e.isFieldInvalid(e.registerForm,"password")?"error":""),o(2),i("nzSpan",24),o(2),i("nzSpan",24)("nzErrorTip",e.getErrorMessage(e.registerForm,"confirmPassword")),o(),i("nzStatus",e.isFieldInvalid(e.registerForm,"confirmPassword")?"error":""),o(2),i("nzSpan",24),o(),i("nzLoading",e.isLoading)("disabled",e.registerForm.invalid)}}var ue=class p{constructor(t,e,r,n,l){this.fb=t;this.authService=e;this.dbService=r;this.router=n;this.message=l}initialMode="login";redirectUrl="/dashboard";loginSuccess=new z;registerSuccess=new z;modeChanged=new z;loginForm;registerForm;isLoginMode=!0;isLoading=!1;ngOnInit(){this.isLoginMode=this.initialMode==="login",this.initializeForms()}initializeForms(){this.loginForm=this.fb.group({email:["",[u.required,d.validEmail()]],password:["",[u.required]],rememberMe:[!1]}),this.registerForm=this.fb.group({firstName:["",[u.required,d.validName()]],lastName:["",[u.required,d.validName()]],email:["",[u.required,d.validEmail()],[d.goodEmail(this.dbService)]],password:["",[u.required,d.strongPassword()]],confirmPassword:["",[u.required]]}),this.registerForm.get("confirmPassword")?.setValidators([u.required,d.passwordMatch("password")])}toggleMode(){this.isLoginMode=!this.isLoginMode,this.resetForms(),this.modeChanged.emit(this.isLoginMode?"login":"register")}resetForms(){this.loginForm.reset(),this.registerForm.reset(),this.loginForm.get("rememberMe")?.setValue(!1)}onLogin(){return y(this,null,function*(){if(this.loginForm.valid){this.isLoading=!0;try{let{email:t,password:e,rememberMe:r}=this.loginForm.value;yield this.authService.signIn(t,e,r);let n=this.authService.getCurrentUser();n&&this.loginSuccess.emit(n),this.message.success("Login successful!"),this.router.navigate([this.redirectUrl])}catch(t){this.message.error(t.message||"Login failed")}finally{this.isLoading=!1}}else this.markFormGroupTouched(this.loginForm)})}onRegister(){return y(this,null,function*(){if(this.registerForm.valid){this.isLoading=!0;try{let{email:t,password:e,firstName:r,lastName:n}=this.registerForm.value;yield this.authService.signUp(t,e,r,n),this.registerSuccess.emit(),this.message.success("Registration successful! Please check your email to verify your account."),this.isLoginMode=!0,this.resetForms()}catch(t){this.message.error(t.message||"Registration failed")}finally{this.isLoading=!1}}else this.markFormGroupTouched(this.registerForm)})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{t.get(e)?.markAsTouched()})}getErrorMessage(t,e){let r=t.get(e);if(r?.hasError("required"))return`${this.getFieldDisplayName(e)} is required`;if(r?.hasError("invalidEmail"))return"Please enter a valid email address";if(r?.hasError("emailExists"))return"This email address is already registered. Please use a different email or try logging in.";if(r?.hasError("invalidName"))return"Name can only contain letters and spaces";if(r?.hasError("passwordMismatch"))return"Passwords do not match";if(r?.hasError("strongPassword")){let n=r.errors.strongPassword,l=[];return n.minLength&&l.push("at least 6 characters"),n.missingUpperCase&&l.push("one uppercase letter"),n.missingLowerCase&&l.push("one lowercase letter"),n.missingNumeric&&l.push("one number"),n.missingSpecialChar&&l.push("one special character"),`Password must contain ${l.join(", ")}`}return""}getFieldDisplayName(t){return{firstName:"First name",lastName:"Last name",email:"Email",password:"Password",confirmPassword:"Confirm password"}[t]||t}isFieldInvalid(t,e){let r=t.get(e);return!!(r?.invalid&&(r?.dirty||r?.touched))}static \u0275fac=function(e){return new(e||p)(f(q),f(ce),f(pe),f(de),f(se))};static \u0275cmp=I({type:p,selectors:[["app-login"]],inputs:{initialMode:"initialMode",redirectUrl:"redirectUrl"},outputs:{loginSuccess:"loginSuccess",registerSuccess:"registerSuccess",modeChanged:"modeChanged"},decls:8,vars:5,consts:[[1,"auth-container"],[1,"auth-card",3,"nzTitle"],["nz-form","","class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"toggle-section"],["nzText","or"],["nz-button","","nzType","link","nzBlock","",3,"click","disabled"],["nz-form","",1,"auth-form",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],[3,"nzSpan","nzErrorTip"],["nz-input","","formControlName","email","placeholder","Enter your email","type","email",3,"nzStatus"],["nz-input","","formControlName","password","placeholder","Enter your password","type","password",3,"nzStatus"],[3,"nzSpan"],["nz-checkbox","","formControlName","rememberMe"],["nz-button","","nzType","primary","nzBlock","",3,"nzLoading","disabled"],["nz-input","","formControlName","firstName","placeholder","Enter your first name","type","text",3,"nzStatus"],["nz-input","","formControlName","lastName","placeholder","Enter your last name","type","text",3,"nzStatus"],["nz-input","","formControlName","confirmPassword","placeholder","Confirm your password","type","password",3,"nzStatus"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"nz-card",1),P(2,ve,19,13,"form",2)(3,he,30,24,"form",2),a(4,"div",3),c(5,"nz-divider",4),a(6,"button",5),S("click",function(){return r.toggleMode()}),m(7),s()()()()),e&2&&(o(),i("nzTitle",r.isLoginMode?"Login":"Register"),o(),i("ngIf",r.isLoginMode),o(),i("ngIf",!r.isLoginMode),o(3),i("disabled",r.isLoading),o(),T(" ",r.isLoginMode?"Don't have an account? Register":"Already have an account? Login"," "))},dependencies:[D,V,j,G,A,R,k,U,O,oe,te,K,Z,B,H,$,J,W,X,Q,ie,re,Y,ee,ae,ne,le,me],styles:[".auth-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}.auth-card[_ngcontent-%COMP%]{width:200%;max-width:400px}"]})};export{ue as LoginComponent};
